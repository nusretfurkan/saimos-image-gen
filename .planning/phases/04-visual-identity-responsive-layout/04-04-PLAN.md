---
phase: 04-visual-identity-responsive-layout
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/filter-controls.tsx
  - src/components/result-display.tsx
autonomous: true
gap_closure: true
requirements:
  - VIS-03
  - UX-02

must_haves:
  truths:
    - "Aspect ratio pill buttons use sage/cream design tokens, not generic Tailwind green/gray/white"
    - "Resolution pill buttons use sage/cream design tokens, not generic Tailwind green/gray/white"
    - "Cost indicator text uses ink token, not generic gray"
    - "Pill buttons have touch-friendly minimum height (44px)"
  artifacts:
    - path: "src/components/filter-controls.tsx"
      provides: "Design-system-migrated filter controls"
      contains: "sage-500|sage-50|cream-100|ink-500"
  key_links:
    - from: "src/components/filter-controls.tsx"
      to: "src/app/globals.css"
      via: "sage/cream/ink design token utility classes"
      pattern: "(sage-|cream-|ink-)"
---

<objective>
Migrate filter-controls.tsx from generic Tailwind color classes to the design system tokens, and apply the animate-fade-in token in result-display.tsx.

Purpose: Close the 3 gaps identified in 04-VERIFICATION.md. Gap 1 (filter-controls.tsx using green/gray/white instead of sage/cream/ink) is the blocker preventing VIS-03 sign-off. Gap 2 (mode-selector.tsx missing) is resolved by clarification -- the app intentionally uses implicit mode detection, so no component is needed. Gap 3 (animate-fade-in not exercised) is a minor token-hygiene cleanup.

Output: Two updated component files that fully conform to the Phase 4 design system.
</objective>

<execution_context>
@/Users/nusretozturk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nusretozturk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-visual-identity-responsive-layout/04-VERIFICATION.md
@src/components/filter-controls.tsx
@src/components/result-display.tsx
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate filter-controls.tsx to design system tokens</name>
  <files>src/components/filter-controls.tsx</files>
  <action>
Replace all generic Tailwind color classes in filter-controls.tsx with the sage/cream/ink design tokens defined in globals.css. Specific changes:

**Selected state pill buttons (aspect ratio, lines ~38-42; resolution, lines ~71-75):**
Replace `border-green-600 bg-green-50 text-green-800` with `border-sage-500 bg-sage-100 text-sage-800`.

**Unselected state pill buttons (aspect ratio, lines ~38-42; resolution, lines ~71-75):**
Replace `border-gray-200 bg-white text-gray-600 hover:border-gray-300` with `border-sage-200/50 bg-cream-100 text-ink-700 hover:bg-cream-200`.

**Cost indicator text (line ~82):**
Replace `text-gray-400` with `text-ink-500`.

**Touch target compliance (both button sets, lines ~38 and ~71):**
Add `min-h-[44px]` to the pill button className strings (both selected and unselected states). The buttons already use `px-3 py-1.5 text-xs` â€” add `min-h-[44px]` alongside so the combined padding and min-height ensure 44px touch targets on mobile.

**Reduced motion (both button sets):**
Add `motion-reduce:transition-none` to the button className (alongside the existing `transition-colors`) to match the convention used in button.tsx and other styled components.

Do NOT change: The flex layout, the aspect ratio shape indicator `<span>`, the section labels (which already use `text-ink-700`), or the 4K amber warning text.
  </action>
  <verify>
Run: `grep -n "green-\|gray-\|bg-white" src/components/filter-controls.tsx`
Expected: Zero matches. No generic Tailwind green/gray/white classes remain.

Run: `grep -c "sage-\|cream-\|ink-" src/components/filter-controls.tsx`
Expected: Count >= 8 (multiple sage/cream/ink token references).

Run: `grep -c "min-h-\[44px\]" src/components/filter-controls.tsx`
Expected: Count = 2 (one per button set).
  </verify>
  <done>
All pill buttons in filter-controls.tsx use sage/cream/ink design tokens. Selected state is sage-500/sage-100/sage-800. Unselected state is sage-200/cream-100/ink-700. Cost text is ink-500. Both button sets have min-h-[44px] for touch targets and motion-reduce:transition-none.
  </done>
</task>

<task type="auto">
  <name>Task 2: Apply animate-fade-in token to result-display.tsx initial appearance</name>
  <files>src/components/result-display.tsx</files>
  <action>
Add the `animate-fade-in` class to the initial image appearance in result-display.tsx. The crossfade between regenerated images should keep its manual `transition-opacity duration-500 ease-soft` approach (crossfade requires coordinated opacity on two elements, which the one-shot animation cannot handle). But the first-time image container appearance can use the token.

Specifically: On the image container div at line ~127 (`<div className="relative overflow-hidden rounded-xl bg-cream-100 shadow-card ..."`), add `animate-fade-in` to the className. This exercises the custom animation token from globals.css on the hero element's first appearance.

Do NOT change: The crossfade logic (lines ~129-148), the loading overlay, or the error state. The manual `transition-opacity` on the individual `<img>` elements is correct for crossfade and should remain.
  </action>
  <verify>
Run: `grep -n "animate-fade-in" src/components/result-display.tsx`
Expected: At least 1 match showing the token in use on the image container.

Run: `grep -n "transition-opacity" src/components/result-display.tsx`
Expected: Still present (crossfade img elements should retain their manual transitions).
  </verify>
  <done>
The animate-fade-in design token is exercised on the result display container's initial appearance. The crossfade between regenerated images continues to use manual transition-opacity for coordinated two-element opacity control.
  </done>
</task>

</tasks>

<verification>
1. `grep -rn "green-\|gray-\|bg-white" src/components/filter-controls.tsx` returns zero matches
2. `grep -rn "sage-\|cream-\|ink-" src/components/filter-controls.tsx` returns >= 8 matches
3. `grep -c "min-h-\[44px\]" src/components/filter-controls.tsx` returns 2
4. `grep -n "animate-fade-in" src/components/result-display.tsx` returns >= 1 match
5. `npm run build` passes with no errors
6. Visual inspection: pill buttons in filter controls match the warm sage/cream aesthetic of the rest of the UI

**Gap 2 resolution (mode-selector.tsx):** No action needed. The app intentionally uses contextual mode detection (`isImageToImage` derived from `uploadedImage !== null`). There is no discrete mode selector component, and none should be created. The 04-03 plan artifact list was incorrect -- this gap is closed by clarification, not code.
</verification>

<success_criteria>
- filter-controls.tsx contains zero instances of `green-`, `gray-`, or `bg-white`
- filter-controls.tsx uses sage-500, sage-100, sage-800, sage-200, cream-100, cream-200, ink-700, ink-500 tokens
- Both pill button sets have min-h-[44px] touch targets
- result-display.tsx uses the animate-fade-in design token
- `npm run build` passes successfully
</success_criteria>

<output>
After completion, create `.planning/phases/04-visual-identity-responsive-layout/04-04-SUMMARY.md`
</output>
