---
phase: 02-text-to-image-generation
plan: 03
type: execute
wave: 2
depends_on:
  - 02-01
files_modified:
  - src/components/result-display.tsx
autonomous: true
requirements:
  - OUT-01
  - UX-01
  - UX-07

must_haves:
  truths:
    - "Generated image displays prominently as the hero element on the page"
    - "Output area is completely hidden before the first generation (no placeholder, no empty box)"
    - "First image fades in with a smooth opacity transition"
    - "During regeneration, previous image stays visible with a loading overlay on top"
    - "Loading overlay shows a spinner with 'Generating...' text"
    - "New image crossfades in over the previous image when generation completes"
    - "When generation fails, an inline error message appears with the specific error text"
    - "Error message includes a 'Try Again' button that retriggers generation"
  artifacts:
    - path: "src/components/result-display.tsx"
      provides: "Image display with crossfade transition, loading overlay, and inline error with retry"
      exports: ["ResultDisplay"]
  key_links:
    - from: "src/app/page.tsx"
      to: "src/components/result-display.tsx"
      via: "component import already wired in 02-01"
      pattern: "import.*ResultDisplay"
    - from: "src/components/result-display.tsx"
      to: "URL.createObjectURL"
      via: "displays blob URL from page state as img src"
      pattern: "src=.*imageUrl"
---

<objective>
Create the result display component that shows generated images with a polished reveal experience: fade-in for the first image, crossfade with loading overlay for regeneration, and inline error messages with retry. Replaces the placeholder ResultDisplay from plan 02-01.

Purpose: The generated image is the hero of the entire app. This component makes the output experience smooth (crossfade, no layout shift), informative (loading state), and recoverable (inline errors with retry).

Output: Fully functional ResultDisplay component handling all three visual states: initial hidden, loading with overlay, and image displayed with crossfade.
</objective>

<execution_context>
@/Users/nusretozturk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nusretozturk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-text-to-image-generation/02-CONTEXT.md
@.planning/phases/02-text-to-image-generation/02-RESEARCH.md
@.planning/phases/02-text-to-image-generation/02-01-SUMMARY.md

# Source files from 02-01:
@src/app/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ResultDisplay component with crossfade, loading overlay, and error state</name>
  <files>src/components/result-display.tsx</files>
  <action>
**Replace the placeholder `src/components/result-display.tsx`** with the full implementation:

- `"use client"` directive
- Import `useState` from React (for tracking the previous image URL internally)
- Props interface:
  ```typescript
  interface ResultDisplayProps {
    imageUrl: string | null;
    isLoading: boolean;
    error: string | null;
    onRetry: () => void;
  }
  ```
- Named export `ResultDisplay`

**State management for crossfade:**
- Internal `displayedUrl` state (string | null): tracks the currently visible image for crossfade
- Internal `previousUrl` state (string | null): tracks the previous image for crossfade overlay
- Use `useEffect` to track when `imageUrl` changes:
  - When `imageUrl` changes AND is not null AND differs from `displayedUrl`:
    - Set `previousUrl` to current `displayedUrl`
    - Set `displayedUrl` to new `imageUrl`
  - When `imageUrl` is null: reset both to null

**Alternative simpler approach (preferred):** Use a `useRef` to track the previous image URL, and manage the crossfade purely through CSS opacity transitions. The component tracks `previousImageUrl` via ref and updates it after the new image loads.

```typescript
const previousImageRef = useRef<string | null>(null);
const [imageLoaded, setImageLoaded] = useState(false);
```

When `imageUrl` changes (detected in render by comparing to ref), set `imageLoaded = false`. When the new `<img>` fires `onLoad`, set `imageLoaded = true` and update `previousImageRef.current = imageUrl`.

**Render logic -- three states:**

**State 1: Nothing generated yet** (`imageUrl === null && !isLoading && !error`)
- Render nothing (return null or empty fragment)
- Per context: "Output area completely hidden before first generation (no placeholder, no empty box)"

**State 2: Has image (and possibly loading overlay)**
- Container: `<div className="relative overflow-hidden rounded-xl">` (rounded corners, clip overflow)
- Previous image (for crossfade during regeneration):
  - Only render if `previousImageRef.current` exists AND `previousImageRef.current !== imageUrl`
  - `<img>` with `absolute inset-0 w-full h-auto` positioning
  - Opacity transitions: `transition-opacity duration-500`
  - Opacity: `imageLoaded ? "opacity-0" : "opacity-100"` (fades out as new image fades in)
- Current image:
  - `<img src={imageUrl} alt="Generated image">` (always present when imageUrl is set)
  - `transition-opacity duration-500`
  - Opacity: `imageLoaded ? "opacity-100" : "opacity-0"` (fades in when loaded)
  - `onLoad` handler: sets `imageLoaded = true`, updates `previousImageRef.current`, and calls `URL.revokeObjectURL(previousImageRef.current)` IF the previous URL is different from the current one
  - For first-time display (no previous image): same fade-in via opacity transition
- Loading overlay (when `isLoading` is true AND at least one image has been generated):
  - `<div className="absolute inset-0 flex items-center justify-center bg-black/30 backdrop-blur-sm rounded-xl">`
  - Spinner: SVG circle with `animate-spin` (Tailwind built-in). Use a simple 24px SVG spinner -- no library needed.
  - Text: `<span className="text-white text-sm font-medium">Generating...</span>`
  - Per context: "Spinner overlays the previous image during regeneration (not replacing it with blank)"

**State 3: First-time loading** (`imageUrl === null && isLoading`)
- Show a centered loading indicator without any image background
- Container with min-height to prevent layout shift: `<div className="flex items-center justify-center py-24">`
- Same spinner + "Generating..." text but on a plain background

**Error state** (rendered BELOW the image container, not replacing it):
- Only render when `error` is not null
- `<div className="flex items-center gap-3 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700">`
- Error text: `<span className="flex-1">{error}</span>`
- Retry button: `<button onClick={onRetry} className="shrink-0 rounded-lg bg-red-100 px-3 py-1 text-red-700 font-medium hover:bg-red-200 transition-colors">Try Again</button>`
- Per context: errors are inline, never modals, with a "Try Again" option

**Spinner SVG** (inline, no dependency):
```tsx
function Spinner() {
  return (
    <svg
      className="animate-spin h-6 w-6 text-white"
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
    >
      <circle
        className="opacity-25"
        cx="12" cy="12" r="10"
        stroke="currentColor" strokeWidth="4"
      />
      <path
        className="opacity-75"
        fill="currentColor"
        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"
      />
    </svg>
  );
}
```

**Key details from user decisions (Claude's Discretion in CONTEXT.md):**
- Image is the hero -- everything else is secondary
- Smooth fade-in transition when image first appears
- On regeneration: previous image stays visible during loading, crossfades to new result
- Spinner overlays the previous image during regeneration
- Error messages are inline, never modals -- with a "Try Again" option
  </action>
  <verify>
1. Run `npm run build` -- no TypeScript errors
2. Before first generation: verify no output area is visible (inspect DOM -- should be empty/null)
3. Trigger a generation: image should fade in with opacity transition
4. Trigger a regeneration: previous image stays visible, spinner overlay appears, new image crossfades in
5. Trigger an error (e.g., empty prompt bypass or network failure): inline error with red styling and "Try Again" button should appear
6. Click "Try Again" -- should retrigger the generation
  </verify>
  <done>ResultDisplay renders nothing before first generation, fades in the first image, overlays a spinner during regeneration while keeping the previous image visible, crossfades to the new image on load, and shows inline errors with a retry button. No layout shift on first image appearance.</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. ResultDisplay returns null/empty when no image, no loading, no error
3. First image fades in via CSS opacity transition (duration ~500ms)
4. Regeneration: previous image visible + spinner overlay + crossfade to new image
5. Loading state shows spinner SVG with "Generating..." text
6. Error state shows inline red banner with error message and "Try Again" button
7. "Try Again" button calls the onRetry prop
8. Previous image blob URL is revoked after new image loads via onLoad handler
</verification>

<success_criteria>
- Generated image is the most prominent element on the page (hero)
- No visible output area before first generation
- Smooth fade-in on first image
- Spinner overlays previous image during regeneration (not blank)
- Crossfade transition between old and new images
- Inline error messages with specific text from API
- "Try Again" button retriggers generation
</success_criteria>

<output>
After completion, create `.planning/phases/02-text-to-image-generation/02-03-SUMMARY.md`
</output>
