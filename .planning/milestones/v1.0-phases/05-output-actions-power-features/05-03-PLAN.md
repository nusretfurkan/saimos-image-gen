---
phase: 05-output-actions-power-features
plan: 03
type: execute
wave: 1
depends_on: []
files_modified: [src/components/result-display.tsx]
autonomous: true
gap_closure: true
requirements: [OUT-02, OUT-03, OUT-04]

must_haves:
  truths:
    - "User can click the generated image to open a fullscreen dark-overlay view"
    - "User can close fullscreen via X button, backdrop click, or Escape key"
    - "User can download the generated image as saimos-gen-{timestamp}.png"
    - "User can copy the generated image to clipboard with a single click"
  artifacts:
    - path: "src/components/result-display.tsx"
      provides: "Image display with fullscreen, download, and copy wiring"
      contains: "FullscreenViewer"
    - path: "src/components/result-display.tsx"
      provides: "ImageActions integration"
      contains: "ImageActions"
  key_links:
    - from: "src/components/result-display.tsx"
      to: "src/components/fullscreen-viewer.tsx"
      via: "renders FullscreenViewer with isOpen state and onClose handler"
      pattern: "<FullscreenViewer"
    - from: "src/components/result-display.tsx"
      to: "src/components/image-actions.tsx"
      via: "renders ImageActions with imageUrl prop"
      pattern: "<ImageActions"
    - from: "src/components/result-display.tsx"
      to: "click-to-fullscreen"
      via: "onClick on image sets isFullscreen(true)"
      pattern: "setIsFullscreen\\(true\\)"
---

<objective>
Wire the orphaned FullscreenViewer and ImageActions components into result-display.tsx, restoring the fullscreen view, download, and clipboard copy features that were lost when a Phase 2 commit overwrote the Phase 5 integration.

Purpose: Close the 4 verification gaps (all Plan 01) so users can view images fullscreen, download them, and copy to clipboard.
Output: Updated result-display.tsx with all three features integrated and functional.
</objective>

<execution_context>
@/Users/nusretozturk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/nusretozturk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-output-actions-power-features/05-VERIFICATION.md
@src/components/result-display.tsx
@src/components/fullscreen-viewer.tsx
@src/components/image-actions.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire FullscreenViewer and ImageActions into result-display.tsx</name>
  <files>src/components/result-display.tsx</files>
  <action>
Edit src/components/result-display.tsx to integrate the two orphaned components. All changes are additive — do NOT rewrite existing crossfade, loading overlay, or error state logic.

**1. Add imports (top of file, after existing imports):**
```tsx
import { FullscreenViewer } from "@/components/fullscreen-viewer";
import { ImageActions } from "@/components/image-actions";
```

**2. Add isFullscreen state (inside the component, alongside existing useState calls):**
```tsx
const [isFullscreen, setIsFullscreen] = useState(false);
```

**3. Make the current generated image clickable for fullscreen:**

Find the current image `<img>` tag for the generated image (the one with `alt="Generated image"`). Wrap it in a `<button>` element to make it clickable:
```tsx
<button
  type="button"
  onClick={() => setIsFullscreen(true)}
  className="w-full cursor-zoom-in"
  aria-label="View fullscreen"
>
  <img ... existing props ... />
</button>
```

Use a `<button>` (not a `<div>`) for accessibility. The `cursor-zoom-in` class signals clickability. Keep all existing image classes and onLoad handler intact.

**4. Render ImageActions below the image container:**

After the `hasAnyImage` block's closing `</div>` and before the error block, add:
```tsx
{imageUrl && !isLoading && (
  <ImageActions imageUrl={imageUrl} />
)}
```

Guard on `imageUrl` (not null) AND `!isLoading` (hide actions while regenerating to prevent acting on stale image).

**5. Render FullscreenViewer at the bottom of the return JSX:**

Before the closing `</div>` of the main return, add:
```tsx
{imageUrl && (
  <FullscreenViewer
    imageUrl={imageUrl}
    isOpen={isFullscreen}
    onClose={() => setIsFullscreen(false)}
  />
)}
```

Guard on `imageUrl` so the dialog is only mounted when there is an image to display.

**Important constraints:**
- Do NOT modify the Spinner component, crossfade logic, loading overlay, error state, or originalImage thumbnail — they work correctly.
- Do NOT change the component's props interface.
- Do NOT touch any other files — fullscreen-viewer.tsx, image-actions.tsx, and image-utils.ts are already correct and complete.
- The existing `animate-fade-in`, `shadow-card`, `hover:shadow-elevated` classes on the image container must remain.
  </action>
  <verify>
Run these checks:

1. `grep -c "FullscreenViewer" src/components/result-display.tsx` — must return 2 or more (import + JSX usage)
2. `grep -c "ImageActions" src/components/result-display.tsx` — must return 2 or more (import + JSX usage)
3. `grep -c "isFullscreen" src/components/result-display.tsx` — must return 3 or more (state declaration + setter call + isOpen prop)
4. `grep "setIsFullscreen(true)" src/components/result-display.tsx` — must match (click handler)
5. `grep "cursor-zoom-in" src/components/result-display.tsx` — must match (clickable image)
6. `npx next build` — must succeed with no errors (type-check included)

If build fails on type errors, check that FullscreenViewer props match: `imageUrl: string, isOpen: boolean, onClose: () => void` and ImageActions props match: `imageUrl: string`.
  </verify>
  <done>
result-display.tsx imports and renders both FullscreenViewer and ImageActions. Clicking the generated image sets isFullscreen to true, opening the fullscreen dialog. ImageActions (download + copy buttons) appear below the image when an image is present and not loading. The build passes cleanly.
  </done>
</task>

</tasks>

<verification>
After task completion, verify all 4 gaps are closed:

1. **OUT-02 (Fullscreen):** `grep "FullscreenViewer" src/components/result-display.tsx` returns import line AND JSX render. `grep "isFullscreen" src/components/result-display.tsx` returns state + setter + prop.
2. **OUT-03 (Download):** `grep "ImageActions" src/components/result-display.tsx` returns import line AND JSX render. The download button becomes visible through ImageActions.
3. **OUT-04 (Copy):** Same ImageActions render also exposes the copy button (conditionally, based on clipboard support). No separate verification needed.
4. **Build integrity:** `npx next build` succeeds — all types resolve, no missing imports.
</verification>

<success_criteria>
- result-display.tsx imports FullscreenViewer and ImageActions
- Clicking the generated image opens fullscreen (isFullscreen state wired)
- ImageActions renders below the image when imageUrl is present and not loading
- FullscreenViewer renders when imageUrl is present, controlled by isFullscreen/onClose
- `npx next build` passes with zero errors
- No regressions in existing crossfade, loading, or error behavior
</success_criteria>

<output>
After completion, create `.planning/phases/05-output-actions-power-features/05-03-SUMMARY.md`
</output>
